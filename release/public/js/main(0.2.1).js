!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("FormLibrary",[],t):"object"==typeof exports?exports.FormLibrary=t():e.FormLibrary=t()}(self,(()=>(()=>{"use strict";var e={};return(()=>{var t=e;function n(e,t){if(console.log(e,t),!e)return;let c=e.Respondables;console.log("RES",c),c&&c.forEach((e=>{console.log(e);let n=r(t),a="";switch(e.Type){case"textarea":a=o(n.base_id,n.respondable_container_id,n.container),document.getElementById(a+"-name").value=e.Object.Field.Name,document.getElementById(a+"-label").value=e.Object.Field.Label,document.getElementById(a+"-required").checked=e.Object.Field.Required,document.getElementById(a+"-placeholder").value=e.Object.Placeholder;break;case"selectiongroup":a=i(n.base_id,n.respondable_container_id,n.container),document.getElementById(a+"-name").value=e.Object.Field.Name,document.getElementById(a+"-label").value=e.Object.Field.Label,document.getElementById(a+"-required").checked=e.Object.Field.Required;for(let t=1;t<e.Object.CheckableItems.length;t++)d(document.getElementById(a));e.Object.CheckableItems.forEach(((e,t)=>{document.getElementById(a+"-checkable-label-"+t).value=e.Label,document.getElementById(a+"-checkable-value-"+t).value=e.Value}))}})),a(!0);let s=e.SubGroups;console.log("GS",s),s&&s.forEach((e=>{let a=l(t);document.getElementById(a+"-label").value=e.Label,document.getElementById(a+"-id").value=e.ID,document.getElementById(a+"-description").value=e.Description,n(e,document.getElementById(a))}))}function a(e){let t=Array.from(document.getElementsByTagName("BUTTON")),n=Array.from(document.getElementsByTagName("INPUT")),a=Array.from(document.getElementsByTagName("SELECT")),l=[].concat(t,n,a);for(let t=0;t<l.length;t++)e?l[t].setAttribute("disabled",""+e):l[t].removeAttribute("disabled")}function l(e){let t=e.getAttribute("data-link-id"),n=document.getElementById(t+"-group");console.log(t,n,e);let a="group"+(Date.now()+Math.random()),l=document.createElement("DIV");return l.className="subgroup form-group",l.id=a+"-group",l.setAttribute("style",""),l.innerHTML=`<LABEL>Group Label : <INPUT type="text" name="form-label" id="${a}-label"/> </LABEL> <br/>\n  <LABEL>Group ID : <INPUT type="text" name="id" id="${a}-id"/></LABEL> <br/>\n  <LABEL>Group Descriptor : <br/> <TEXTAREA name="description" id="${a}-description"></TEXTAREA></LABEL> <br/>\n  <BUTTON id="${a}" onclick="FormLibrary.createNewResponseElement(this)" data-link-id="${a}" >Create New Respondable Below Last Respondable</BUTTON><br/>\n  <BUTTON  onclick="FormLibrary.createNewSubgroup(this)" data-link-id="${a}">Create New Group Below Last Respondable</BUTTON><br/>\n  <BUTTON  onclick="FormLibrary.deleteContainer('${t+"-group"}' , '${a+"-group"}')">Delete Subgroup</BUTTON><br/>\n  <SPAN  class="respondable-container" id="${a}-respondables"></SPAN><BR/>\n  `,n.appendChild(l),a}function r(e){let t=e.getAttribute("data-link-id"),n=document.getElementById(t+"-respondables");console.log(t,n);let a="response"+(Date.now()+Math.random()),l=document.createElement("DIV");return l.className="creation-prompt respondable-group",l.id=a+"-fields",l.setAttribute("style","width:400px;min-height:200px"),l.innerHTML=`Element Creation Info:<BR/>\n    <UL>\n      <LI>Item Type:\n        <SELECT id="${a}-type">\n          <OPTION value="textarea">TextArea</OPTION>\n          <OPTION value="input">Input(unimplemented)</OPTION>\n          <OPTION value="file">FileInput(unimplemented)</OPTION>\n          <OPTION value="select">SelectGroup</OPTION>\n          <OPTION value="option">OptionGroup(unimplemented)</OPTION>\n        </SELECT>\n      </LI>\n      <LI>If we want any of the unimplemented features, then you'll have to ask me or wait until I personally require it</LI>\n      <LI><BUTTON id="${a}" data-link-id="${a}" onclick="FormLibrary.responseTypeSelected('${t+"-respondables"}' , this)">Next</BUTTON></LI>\n      <LI><BUTTON  data-link-id="${a}" onclick="FormLibrary.deleteContainer('${t+"-respondables"}' , '${a+"-fields"}')">Delete</BUTTON></LI>\n    </UL>`,n.appendChild(l),{base_id:a,respondable_container_id:t+"-respondables",container:l}}function o(e,t,n){let a="field"+e,l="text-area"+(Date.now()+Math.random());return n.className="respondable-group",n.id=l,n.setAttribute("data-type","textarea"),n.setAttribute("style","width:400px;min-height:200px"),n.innerHTML=`TextArea Creation Info:<BR/>\n    <UL>\n      <LI>\n        Name : <INPUT   data-field="1" name='Name' id="${a}-name"/><BR/>\n      </LI>\n      <LI>\n        Label : <INPUT  data-field="1" name='Label' id="${a}-label"/><BR/>\n      </LI>\n      <LI>\n        Required : <INPUT  data-field="1" name='Required' id="${a}-required" type="checkbox"/><BR/>\n      </LI>\n      <LI>\n        Placeholder : <INPUT  data-field="1" name='Placeholder' id="${a}-placeholder"/><BR/>\n      </LI>\n      <LI><BUTTON id="${l}" onclick="FormLibrary.deleteContainer('${t}' , '${l}')">Delete</BUTTON></LI>\n    </UL>`,a}function i(e,t,n){let a="field"+(Date.now()+Math.random()),l="select"+(Date.now()+Math.random());return n.className="respondable-group",n.id=l,n.setAttribute("data-type","selectiongroup"),n.setAttribute("style","width:400px;min-height:200px"),n.innerHTML=`SelectGroup Creation Info:<BR/>\n    <UL>\n      <LI>\n        Name : <INPUT  data-field="1" name='Name' id="${a}-name"/><BR/>\n      </LI>\n      <LI>\n        Label : <INPUT  data-field="1" name='Label' id="${a}-label"/><BR/>\n      </LI>\n      <LI>\n        Required : <INPUT  data-field="1" name='Required' type="checkbox" id="${a}-required"/><BR/>\n      </LI>\n      <LI>\n        Select type : <SELECT  data-field="1" name='SelectionCategory' type="checkbox" id="${a}-selectioncatergory">\n          <OPTION value="checkbox">checkbox</OPTION>\n          <OPTION value="radio">radio</OPTION>\n        </SELECT><BR/>\n      </LI>\n      <LI>\n        Group Items :\n        <BUTTON id="${a}" onclick="FormLibrary.addCheckable(this)" data-link-id="${a}">+</BUTTON>\n        <BUTTON onclick="FormLibrary.removeCheckable(this)" data-link-id="${a}">-</BUTTON><BR/>\n        <OL data-field="1" data-select="1" id="${a}-checkable">\n          <LI>\n            <INPUT placeholder="Label"  data-checkable-no="0" data-field="1" name='Label' id="${a}-checkable-label-0"/>\n            <INPUT placeholder="Value"  data-checkable-no="0" data-field="1" name='Value'  id="${a}-checkable-value-0"/>\n          </LI>\n        </OL>\n      </LI>\n      <LI><BUTTON id="${l}" onclick="FormLibrary.deleteContainer('${t}' , '${l}')">Delete</BUTTON></LI>\n    </UL>`,a}function d(e){let t=e.getAttribute("data-link-id"),n=document.getElementById(t+"-checkable"),a=document.createElement("LI"),l=n.children.length;a.innerHTML=`\n    <INPUT placeholder="Label" data-checkable-no="${l}" data-field="1" name='Label' id="${t}-checkable-label-${l}"/>\n    <INPUT placeholder="Value" data-checkable-no="${l}" data-field="1" name='Value' id="${t}-checkable-value-${l}"/>\n  `,n.appendChild(a)}function c(e,t){let n={FormName:"",ID:"",Description:"",AnonOption:!1,FormFields:[]},a=[],l=0,r=document.getElementById("head-group").childNodes;for(let e=0;e<r.length;e++)if(r[e].nodeType==Node.ELEMENT_NODE)if(-1!=r[e].className.indexOf("form-group"))a.unshift({node:r[e],paths:[l]}),l+=1,n.FormFields.push({Label:"",ID:"",Description:"",SubGroups:[],Respondables:[]});else if("LABEL"==r[e].tagName.toUpperCase()){let t=r[e].getElementsByTagName("INPUT")[0];if(t||(t=r[e].getElementsByTagName("SELECT")[0]),t||(t=r[e].getElementsByTagName("TEXTAREA")[0]),!t)continue;switch(t.getAttribute("name")){case"form-name":n.FormName=t.value;break;case"id":n.ID=t.value;break;case"description":n.Description=t.value;break;case"anon-option":n.AnonOption=t.checked}}for(;0!=a.length;){let e=0,t=a.shift(),l=t.paths,r=l[0],o=n.FormFields[r];for(let e=1;e<l.length;e++)o=o.SubGroups[l[e]];for(let n=0;n<t.node.childNodes.length;n++){let r=t.node.childNodes[n];if(r.nodeType==Node.ELEMENT_NODE)if(-1!=r.className.indexOf("form-group")){let t=l;t.push(e),a.unshift({node:r,paths:t}),e+=1,o.SubGroups.push({Label:"",ID:"",Description:"",SubGroups:[],Respondables:[]})}else if(-1!=r.className.indexOf("respondable-container")){if(0==r.childNodes.length)continue;let e=r.childNodes,t=e.length;console.log(e,t);for(let n=0;n<t;n++){let t=e[n],a={Object:{Field:{Name:"",Label:"",Required:!1}},Type:t.getAttribute("data-type")},l=t.getElementsByTagName("INPUT"),r=t.getElementsByTagName("SELECT");r.length&&"selectiongroup"===t.getAttribute("data-type")&&(a.Object[r[0].getAttribute("Name")]=r[0].value);for(let e=0;e<l.length;e++)if("selectiongroup"==t.getAttribute("data-type")){let t=l[e].value;if("checkbox"==l[e].getAttribute("type")&&(t=l[e].checked),l[e].getAttribute("data-checkable-no")){a.Object.CheckableItems||(a.Object.CheckableItems=[]);let n=parseInt(l[e].getAttribute("data-checkable-no"));a.Object.CheckableItems[n]||(a.Object.CheckableItems[n]={}),a.Object.CheckableItems[n][l[e].getAttribute("name")]=t}else switch(l[e].getAttribute("name")){case"Name":case"Label":case"Required":a.Object.Field[l[e].getAttribute("name")]=t;break;default:a.Object[l[e].getAttribute("name")]=t}}else if("fileinput"==t.getAttribute("data-type"));else{let t=l[e].value;switch("checkbox"==l[e].getAttribute("type")&&(t=l[e].checked),console.log(l,l[e].getAttribute("name"),t),l[e].getAttribute("name")){case"Name":case"Label":case"Required":a.Object.Field[l[e].getAttribute("name")]=t;break;default:a.Object[l[e].getAttribute("name")]=t}}o.Respondables.push(a)}}else if("LABEL"==r.tagName.toUpperCase()){let e=r.getElementsByTagName("INPUT")[0];if(e||(e=r.getElementsByTagName("SELECT")[0]),e||(e=r.getElementsByTagName("TEXTAREA")[0]),!e)continue;switch(e.getAttribute("name")){case"form-label":o.Label=e.value;break;case"id":o.ID=e.value;break;case"description":o.Description=e.value}}}}console.log(n),s(JSON.stringify(n),t)}function s(e,t){var n=new FormData;n.append("json","1"),n.append("form-construct-json",e);var a=new XMLHttpRequest;a.open("POST",t,!0),a.onload=u,a.send(n)}function u(e){let t={};try{t=JSON.parse(e.target.responseText),console.log(t,e)}catch(e){return void(document.getElementById("response-container").innerHTML=`Hard server crash<BR/><TEXTAREA>${e.toString()}</TEXTAREA>`)}if(t.error)if(t["error-list"]){let e="There are some issues preventing you from submitting...<br/><ul>";t["error-list"].forEach((t=>{e+="<li>"+t.FailPosition+" : "+t.FailType+"</li>"})),e+="</ul>",document.getElementById("response-container").innerHTML=e}else document.getElementById("response-container").innerHTML="Server error: "+t.error;else document.getElementById("response-container").innerHTML=`${t.message} - ${Date.now()}<br/>\n      ${t.URL?`URL: <a href="${t.URL}">${t.URL}</a>`:""}\n    `}Object.defineProperty(t,"__esModule",{value:!0}),t.postDeleteResponse=t.postDeleteForm=t.handleCreateComplete=t.sendCreateRequest=t.submitForm=t.responseTypeSelected=t.removeCheckable=t.addCheckable=t.createSelectGroup=t.createTextAreaInputs=t.deleteContainer=t.createNewResponseElement=t.createNewSubgroup=t.setFieldsAsDisabled=t.rebuildFromRaw=t.attatchCreators=t.submitUserPost=t.helloWorld=void 0,t.helloWorld=function(){console.log("hello client")},t.submitUserPost=function(e){let t=new FormData(e);t.append("json","1"),console.log(t);let n=new XMLHttpRequest;return n.open("POST",""+window.location),n.onload=u,n.send(t),!1},t.attatchCreators=function(e){console.log(e);let t=document.getElementById("sub-create");t.onclick=()=>l(t);let n=document.getElementById("form-submit-button");n&&(n.onclick=()=>c(0,"/mod/create"));let a=document.getElementById("form-edit-button");a&&(a.onclick=()=>c(0,"/mod/edit/"+e.form_number))},t.rebuildFromRaw=function(e){try{let t={SubGroups:JSON.parse(e).FormFields};console.log("FC",t),n(t,document.getElementById("sub-create"))}catch(e){console.error(e),alert("Issue with rebuilding")}},t.setFieldsAsDisabled=a,t.createNewSubgroup=l,t.createNewResponseElement=r,t.deleteContainer=function(e,t){document.getElementById(e).removeChild(document.getElementById(t))},t.createTextAreaInputs=o,t.createSelectGroup=i,t.addCheckable=d,t.removeCheckable=function(e){let t=e.getAttribute("data-link-id"),n=document.getElementById(t+"-checkable");n.childNodes.length<=1||n.removeChild(n.lastChild)},t.responseTypeSelected=function(e,t){let n=t.getAttribute("data-link-id"),a=document.getElementById(n+"-type"),l=document.getElementById(n+"-fields");switch(console.log(n,a,l),a.value){case"textarea":o(n,e,l);break;case"select":i(0,e,l)}},t.submitForm=c,t.sendCreateRequest=s,t.handleCreateComplete=u,t.postDeleteForm=function(e,t){if(1==confirm("This will remove the form from the display and database.\n    Information files will retained on the server as a record until a duplicate named form is created")){let n=new XMLHttpRequest;n.open("POST",`/mod/form/delete/${e}/${t}`),n.onload=n=>{let a={};try{a=JSON.parse(n.target.responseText)}catch(e){return void alert("Error: Hard server crash")}if(a.error)alert("Error: "+a.error);else{alert("Success: "+a.message);let n=document.getElementById(`row-${e}-${t}`);n.parentNode.removeChild(n)}},n.send()}return!1},t.postDeleteResponse=function(e,t){if(1==confirm("This will remove the response and all information associated with it")){let n=new XMLHttpRequest;n.open("POST",`/mod/response/delete/${e}/${t}`),n.onload=n=>{let a={};try{a=JSON.parse(n.target.responseText)}catch(e){return void alert("Error: Hard server crash")}if(a.error)alert("Error: "+a.error);else{alert("Success: "+a.message);let n=document.getElementById(`row-${e}-${t}`);n.parentNode.removeChild(n)}},n.send()}return!1}})(),e})()));