!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("FormLibrary",[],t):"object"==typeof exports?exports.FormLibrary=t():e.FormLibrary=t()}(self,(()=>(()=>{"use strict";var e={};return(()=>{var t=e;function n(e,t){if(console.log(e,t),!e)return;let u=e.Respondables;console.log("RES",u),u&&u.forEach((e=>{console.log(e);let n=r(t),a="";switch(e.Type){case"textarea":a=i(n.base_id,n.respondable_container_id,n.container),document.getElementById(a+"-name").value=e.Object.Field.Name,document.getElementById(a+"-label").value=e.Object.Field.Label,document.getElementById(a+"-required").checked=e.Object.Field.Required,document.getElementById(a+"-placeholder").value=e.Object.Placeholder;break;case"genericinput":a=d(n.base_id,n.respondable_container_id,n.container),document.getElementById(a+"-name").value=e.Object.Field.Name,document.getElementById(a+"-label").value=e.Object.Field.Label,document.getElementById(a+"-required").checked=e.Object.Field.Required,document.getElementById(a+"-placeholder").value=e.Object.Placeholder,document.getElementById(a+"-type").value=e.Object.Type;break;case"fileinput":a=o(n.base_id,n.respondable_container_id,n.container),document.getElementById(a+"-name").value=e.Object.Field.Name,document.getElementById(a+"-label").value=e.Object.Field.Label,document.getElementById(a+"-required").checked=e.Object.Field.Required,document.getElementById(a+"-allowed-ext").value=e.Object.AllowedExtRegex,document.getElementById(a+"-max-size").value=e.Object.MaxSize;break;case"selectiongroup":a=s(n.base_id,n.respondable_container_id,n.container),document.getElementById(a+"-name").value=e.Object.Field.Name,document.getElementById(a+"-label").value=e.Object.Field.Label,document.getElementById(a+"-required").checked=e.Object.Field.Required;for(let t=1;t<e.Object.CheckableItems.length;t++)c(document.getElementById(a),"checkable");e.Object.CheckableItems.forEach(((e,t)=>{document.getElementById(a+"-checkable-label-"+t).value=e.Label,document.getElementById(a+"-checkable-value-"+t).value=e.Value}));break;case"optiongroup":a=m(n.base_id,n.respondable_container_id,n.container),document.getElementById(a+"-name").value=e.Object.Field.Name,document.getElementById(a+"-label").value=e.Object.Field.Label,document.getElementById(a+"-required").checked=e.Object.Field.Required;for(let t=1;t<e.Object.Options.length;t++)c(document.getElementById(a),"option");e.Object.Options.forEach(((e,t)=>{document.getElementById(a+"-option-label-"+t).value=e.Label,document.getElementById(a+"-option-value-"+t).value=e.Value}))}})),a(!0);let p=e.SubGroups;console.log("GS",p),p&&p.forEach((e=>{let a=l(t);document.getElementById(a+"-label").value=e.Label,document.getElementById(a+"-id").value=e.ID,document.getElementById(a+"-description").value=e.Description,n(e,document.getElementById(a))}))}function a(e){let t=Array.from(document.getElementsByTagName("BUTTON")),n=Array.from(document.getElementsByTagName("INPUT")),a=Array.from(document.getElementsByTagName("SELECT")),l=[].concat(t,n,a);for(let t=0;t<l.length;t++)e?l[t].setAttribute("disabled",""+e):l[t].removeAttribute("disabled")}function l(e){let t=e.getAttribute("data-link-id"),n=document.getElementById(t+"-group");console.log(t,n,e);let a="group"+(Date.now()+Math.random()),l=document.createElement("DIV");return l.className="subgroup form-group",l.id=a+"-group",l.setAttribute("style",""),l.innerHTML=`<LABEL>Group Label : <INPUT type="text" name="form-label" id="${a}-label"/> </LABEL> <br/>\n  <LABEL>Group ID : <INPUT type="text" name="id" id="${a}-id"/></LABEL> <br/>\n  <LABEL>Group Descriptor : <br/> <TEXTAREA name="description" id="${a}-description"></TEXTAREA></LABEL> <br/>\n  <BUTTON id="${a}" onclick="FormLibrary.createNewResponseElement(this)" data-link-id="${a}" >Create New Respondable Below Last Respondable</BUTTON><br/>\n  <BUTTON  onclick="FormLibrary.createNewSubgroup(this)" data-link-id="${a}">Create New Group Below Last Respondable</BUTTON><br/>\n  <BUTTON  onclick="FormLibrary.deleteContainer('${t+"-group"}' , '${a+"-group"}')">Delete Subgroup</BUTTON><br/>\n  <SPAN  class="respondable-container" id="${a}-respondables"></SPAN><BR/>\n  `,n.appendChild(l),a}function r(e){let t=e.getAttribute("data-link-id"),n=document.getElementById(t+"-respondables");console.log(t,n);let a="response"+(Date.now()+Math.random()),l=document.createElement("DIV");return l.className="creation-prompt respondable-group",l.id=a+"-fields",l.setAttribute("style","width:400px;min-height:200px"),l.innerHTML=`Element Creation Info:<BR/>\n    <UL>\n      <LI>Item Type:\n        <SELECT id="${a}-type">\n          <OPTION value="textarea">TextArea</OPTION>\n          <OPTION value="input">Input</OPTION>\n          <OPTION value="file">FileInput</OPTION>\n          <OPTION value="select">SelectGroup</OPTION>\n          <OPTION value="option">OptionGroup</OPTION>\n        </SELECT>\n      </LI>\n      <LI>If we want any of the unimplemented features, then you'll have to ask me or wait until I personally require it</LI>\n      <LI><BUTTON id="${a}" data-link-id="${a}" onclick="FormLibrary.responseTypeSelected('${t+"-respondables"}' , this)">Next</BUTTON></LI>\n      <LI><BUTTON  data-link-id="${a}" onclick="FormLibrary.deleteContainer('${t+"-respondables"}' , '${a+"-fields"}')">Delete</BUTTON></LI>\n    </UL>`,n.appendChild(l),{base_id:a,respondable_container_id:t+"-respondables",container:l}}function i(e,t,n){let a="field"+e,l="text-area"+(Date.now()+Math.random());return n.className="respondable-group",n.id=l,n.setAttribute("data-type","textarea"),n.setAttribute("style","width:400px;min-height:200px"),n.innerHTML=`TextArea Creation Info:<BR/>\n    <UL>\n      <LI>\n        Name : <INPUT   data-field="1" name='Name' id="${a}-name"/><BR/>\n      </LI>\n      <LI>\n        Label : <INPUT  data-field="1" name='Label' id="${a}-label"/><BR/>\n      </LI>\n      <LI>\n        Required : <INPUT  data-field="1" name='Required' id="${a}-required" type="checkbox"/><BR/>\n      </LI>\n      <LI>\n        Placeholder : <INPUT  data-field="1" name='Placeholder' id="${a}-placeholder"/><BR/>\n      </LI>\n      <LI><BUTTON id="${l}" onclick="FormLibrary.deleteContainer('${t}' , '${l}')">Delete</BUTTON></LI>\n    </UL>`,a}function o(e,t,n){let a="field"+e,l="file"+(Date.now()+Math.random());return n.className="respondable-group",n.id=l,n.setAttribute("data-type","fileinput"),n.setAttribute("style","width:400px;min-height:200px"),n.innerHTML=`TextArea Creation Info:<BR/>\n    <UL>\n      <LI>\n        Name : <INPUT   data-field="1" name='Name' id="${a}-name"/><BR/>\n      </LI>\n      <LI>\n        Label : <INPUT  data-field="1" name='Label' id="${a}-label"/><BR/>\n      </LI>\n      <LI>\n        Required : <INPUT  data-field="1" name='Required' id="${a}-required" type="checkbox"/><BR/>\n      </LI>\n      <LI>\n        Allowed Extention Pattern : <INPUT  data-field="1" name='AllowedExtRegex' id="${a}-allowed-ext"/><BR/>\n      </LI>\n      <LI>\n        Max Filesize(Bytes) : <INPUT  data-field="1" type="number" name='MaxSize' id="${a}-max-size"/><BR/>\n      </LI>\n      <LI><BUTTON id="${l}" onclick="FormLibrary.deleteContainer('${t}' , '${l}')">Delete</BUTTON></LI>\n    </UL>`,a}function d(e,t,n){let a="field"+e,l="input"+(Date.now()+Math.random());return n.className="respondable-group",n.id=l,n.setAttribute("data-type","genericinput"),n.setAttribute("style","width:400px;min-height:200px"),n.innerHTML=`Input Creation Info:<BR/>\n    <UL>\n      <LI>\n        Name : <INPUT   data-field="1" name='Name' id="${a}-name"/><BR/>\n      </LI>\n      <LI>\n        Label : <INPUT  data-field="1" name='Label' id="${a}-label"/><BR/>\n      </LI>\n      <LI>\n        Required : <INPUT  data-field="1" name='Required' id="${a}-required" type="checkbox"/><BR/>\n      </LI>\n      <LI>\n        Placeholder : <INPUT  data-field="1" name='Placeholder' id="${a}-placeholder"/><BR/>\n      </LI>\n      <LI>\n        Type : <SELECT data-field="1" name='Type' id="${a}-type">\n          <OPTGROUP label="Text Types">\n            <OPTION value="text">Text</OPTION>\n            <OPTION value="email">Email</OPTION>\n            <OPTION value="number">Number</OPTION>\n            <OPTION value="password">Password</OPTION>\n            <OPTION value="url">URL</OPTION>\n          </OPTGROUP>\n          <OPTGROUP label="Time Types">\n            <OPTION value="time">Time</OPTION>\n            <OPTION value="date">Date</OPTION>\n          </OPTGROUP>\n          <OPTGROUP label="Special Types">\n            <OPTION value="color">Color Picker</OPTION>\n            <OPTION value="range">Number Range</OPTION>\n          </OPTGROUP>\n        </SELECT>\n      </LI>\n      <LI><BUTTON id="${l}" onclick="FormLibrary.deleteContainer('${t}' , '${l}')">Delete</BUTTON></LI>\n    </UL>`,a}function s(e,t,n){let a="field"+(Date.now()+Math.random()),l="select"+(Date.now()+Math.random());return n.className="respondable-group",n.id=l,n.setAttribute("data-type","selectiongroup"),n.setAttribute("style","width:400px;min-height:200px"),n.innerHTML=`SelectGroup Creation Info:<BR/>\n    <UL>\n      <LI>\n        Name : <INPUT  data-field="1" name='Name' id="${a}-name"/><BR/>\n      </LI>\n      <LI>\n        Label : <INPUT  data-field="1" name='Label' id="${a}-label"/><BR/>\n      </LI>\n      <LI>\n        Required : <INPUT  data-field="1" name='Required' type="checkbox" id="${a}-required"/><BR/>\n      </LI>\n      <LI>\n        Select type : <SELECT  data-field="1" name='SelectionCategory' type="checkbox" id="${a}-selectioncatergory">\n          <OPTION value="checkbox">checkbox</OPTION>\n          <OPTION value="radio">radio</OPTION>\n        </SELECT><BR/>\n      </LI>\n      <LI>\n        Group Items :\n        <BUTTON id="${a}" onclick="FormLibrary.addListField(this , 'checkable')" data-link-id="${a}">+</BUTTON>\n        <BUTTON onclick="FormLibrary.removeListItem(this, 'checkable')" data-link-id="${a}">-</BUTTON><BR/>\n        <OL data-field="1" data-select="1" id="${a}-checkable">\n          <LI>\n            <INPUT placeholder="Label"  data-list-item-no="0" data-field="1" name='Label' id="${a}-checkable-label-0"/>\n            <INPUT placeholder="Value"  data-list-item-no="0" data-field="1" name='Value'  id="${a}-checkable-value-0"/>\n          </LI>\n        </OL>\n      </LI>\n      <LI><BUTTON id="${l}" onclick="FormLibrary.deleteContainer('${t}' , '${l}')">Delete</BUTTON></LI>\n    </UL>`,a}function c(e,t){let n=e.getAttribute("data-link-id"),a=document.getElementById(n+"-"+t),l=document.createElement("LI"),r=a.children.length;l.innerHTML=`\n    <INPUT placeholder="Label" data-list-item-no="${r}" data-field="1" name='Label' id="${n}-${t}-label-${r}"/>\n    <INPUT placeholder="Value" data-list-item-no="${r}" data-field="1" name='Value' id="${n}-${t}-value-${r}"/>\n  `,a.appendChild(l)}function m(e,t,n){let a="field"+(Date.now()+Math.random()),l="option"+(Date.now()+Math.random());return n.className="respondable-group",n.id=l,n.setAttribute("data-type","optiongroup"),n.setAttribute("style","width:400px;min-height:200px"),n.innerHTML=`OptionGroup Creation Info:<BR/>\n    <UL>\n      <LI>\n        Name : <INPUT  data-field="1" name='Name' id="${a}-name"/><BR/>\n      </LI>\n      <LI>\n        Label : <INPUT  data-field="1" name='Label' id="${a}-label"/><BR/>\n      </LI>\n      <LI>\n        Required : <INPUT  data-field="1" name='Required' type="checkbox" id="${a}-required"/><BR/>\n      </LI>\n      <LI>\n      Option Fields :\n        <BUTTON id="${a}" onclick="FormLibrary.addListField(this , 'option')" data-link-id="${a}">+</BUTTON>\n        <BUTTON onclick="FormLibrary.removeListItem(this, 'option')" data-link-id="${a}">-</BUTTON><BR/>\n        <OL data-field="1" data-select="1" id="${a}-option">\n          <LI>\n            <INPUT placeholder="Label"  data-list-item-no="0" data-field="1" name='Label' id="${a}-option-label-0"/>\n            <INPUT placeholder="Value"  data-list-item-no="0" data-field="1" name='Value'  id="${a}-option-value-0"/>\n          </LI>\n        </OL>\n      </LI>\n      <LI><BUTTON id="${l}" onclick="FormLibrary.deleteContainer('${t}' , '${l}')">Delete</BUTTON></LI>\n    </UL>`,a}function u(e,t){let n={FormName:"",ID:"",Description:"",AnonOption:!1,FormFields:[]},a=[],l=0,r=document.getElementById("head-group").childNodes;for(let e=0;e<r.length;e++)if(r[e].nodeType==Node.ELEMENT_NODE)if(-1!=r[e].className.indexOf("form-group"))a.unshift({node:r[e],paths:[l]}),l+=1,n.FormFields.push({Label:"",ID:"",Description:"",SubGroups:[],Respondables:[]});else if("LABEL"==r[e].tagName.toUpperCase()){let t=r[e].getElementsByTagName("INPUT")[0];if(t||(t=r[e].getElementsByTagName("SELECT")[0]),t||(t=r[e].getElementsByTagName("TEXTAREA")[0]),!t)continue;switch(t.getAttribute("name")){case"form-name":n.FormName=t.value;break;case"id":n.ID=t.value;break;case"description":n.Description=t.value;break;case"anon-option":n.AnonOption=t.checked}}for(;0!=a.length;){let e=0,t=a.shift(),l=t.paths,r=l[0],i=n.FormFields[r];for(let e=1;e<l.length;e++)i=i.SubGroups[l[e]];for(let n=0;n<t.node.childNodes.length;n++){let r=t.node.childNodes[n];if(r.nodeType==Node.ELEMENT_NODE)if(-1!=r.className.indexOf("form-group")){let t=l;t.push(e),a.unshift({node:r,paths:t}),e+=1,i.SubGroups.push({Label:"",ID:"",Description:"",SubGroups:[],Respondables:[]})}else if(-1!=r.className.indexOf("respondable-container")){if(0==r.childNodes.length)continue;let e=r.childNodes,t=e.length;console.log(e,t);for(let n=0;n<t;n++){let t=e[n],a={Object:{Field:{Name:"",Label:"",Required:!1}},Type:t.getAttribute("data-type")},l=t.getElementsByTagName("INPUT"),r=t.getElementsByTagName("SELECT");if(r.length)switch(t.getAttribute("data-type")){case"selectiongroup":case"genericinput":a.Object[r[0].getAttribute("Name")]=r[0].value}for(let e=0;e<l.length;e++){let n=l[e].value;if("checkbox"==l[e].getAttribute("type")?n=l[e].checked:"number"==l[e].getAttribute("type")&&(n=parseInt(l[e].value)),"selectiongroup"==t.getAttribute("data-type"))if(l[e].getAttribute("data-list-item-no")){a.Object.CheckableItems||(a.Object.CheckableItems=[]);let t=parseInt(l[e].getAttribute("data-list-item-no"));a.Object.CheckableItems[t]||(a.Object.CheckableItems[t]={}),a.Object.CheckableItems[t][l[e].getAttribute("name")]=n}else switch(l[e].getAttribute("name")){case"Name":case"Label":case"Required":a.Object.Field[l[e].getAttribute("name")]=n;break;default:a.Object[l[e].getAttribute("name")]=n}else if("optiongroup"==t.getAttribute("data-type"))if(l[e].getAttribute("data-list-item-no")){a.Object.Options||(a.Object.Options=[]);let t=parseInt(l[e].getAttribute("data-list-item-no"));a.Object.Options[t]||(a.Object.Options[t]={}),a.Object.Options[t][l[e].getAttribute("name")]=n}else switch(l[e].getAttribute("name")){case"Name":case"Label":case"Required":a.Object.Field[l[e].getAttribute("name")]=n;break;default:a.Object[l[e].getAttribute("name")]=n}else switch(console.log(l,l[e].getAttribute("name"),n),l[e].getAttribute("name")){case"Name":case"Label":case"Required":a.Object.Field[l[e].getAttribute("name")]=n;break;default:a.Object[l[e].getAttribute("name")]=n}}i.Respondables.push(a)}}else if("LABEL"==r.tagName.toUpperCase()){let e=r.getElementsByTagName("INPUT")[0];if(e||(e=r.getElementsByTagName("SELECT")[0]),e||(e=r.getElementsByTagName("TEXTAREA")[0]),!e)continue;switch(e.getAttribute("name")){case"form-label":i.Label=e.value;break;case"id":i.ID=e.value;break;case"description":i.Description=e.value}}}}console.log(n),p(JSON.stringify(n),t)}function p(e,t){var n=new FormData;n.append("json","1"),n.append("form-construct-json",e);var a=new XMLHttpRequest;a.open("POST",t,!0),a.onload=b,a.send(n)}function b(e){let t={};try{t=JSON.parse(e.target.responseText),console.log(t,e)}catch(e){return void(document.getElementById("response-container").innerHTML=`Hard server crash<BR/><TEXTAREA>${e.toString()}</TEXTAREA>`)}if(t.error)if(t["error-list"]){let e="There are some issues preventing you from submitting...<br/><ul>";t["error-list"].forEach((t=>{e+="<li>"+t.FailPosition+" : "+t.FailType+"</li>"})),e+="</ul>",document.getElementById("response-container").innerHTML=e}else document.getElementById("response-container").innerHTML="Server error: "+t.error;else document.getElementById("response-container").innerHTML=`${t.message} - ${Date.now()}<br/>\n      ${t.URL?`URL: <a href="${t.URL}">${t.URL}</a>`:""}\n    `}Object.defineProperty(t,"__esModule",{value:!0}),t.postDeleteResponse=t.postDeleteForm=t.handleCreateComplete=t.sendCreateRequest=t.submitForm=t.responseTypeSelected=t.createOptionsGroup=t.removeListItem=t.addListField=t.createSelectGroup=t.createInputInputs=t.createFileInputs=t.createTextAreaInputs=t.deleteContainer=t.createNewResponseElement=t.createNewSubgroup=t.setFieldsAsDisabled=t.rebuildFromRaw=t.attatchCreators=t.submitUserPost=t.dropdownList=t.helloWorld=void 0,t.helloWorld=function(){console.log("hello client")},t.dropdownList=function(e,t){let n=document.getElementById("container-"+t).getElementsByClassName("item-replies").item(0);if("▶"==e.firstChild.textContent){e.firstChild.textContent="( ...Loading... )";let a=new XMLHttpRequest;a.open("GET","/mod/api/form/"+t),a.onload=function(t){let a;e.firstChild.textContent="▼";try{a=JSON.parse(t.target.responseText),console.log(a,t)}catch(e){return void(n.innerHTML=`Hard server crash<BR/><TEXTAREA>${e.toString()}</TEXTAREA>`)}var l;a.error?n.innerHTML=a.error:n.innerHTML=(l=a,`<UL>${(()=>{if(!l.formatted_replies)return"<LI>Empty Set</LI>";let e="";return l.formatted_replies.forEach((t=>{e+=`<LI>${t}</LI>`})),e})()}</UL>`)},a.onerror=function(){n.innerHTML="Server Issue"},a.send()}else"▼"==e.firstChild.textContent&&(e.firstChild.textContent="▶",n.innerHTML="");return!1},t.submitUserPost=function(e){let t=new FormData(e);t.append("json","1"),console.log(t);let n=new XMLHttpRequest;return n.open("POST",""+window.location),n.onload=b,n.send(t),!1},t.attatchCreators=function(e){console.log(e);let t=document.getElementById("sub-create");t.onclick=()=>l(t);let n=document.getElementById("form-submit-button");n&&(n.onclick=()=>u(0,"/mod/create"));let a=document.getElementById("form-edit-button");a&&(a.onclick=()=>u(0,"/mod/edit/"+e.form_number))},t.rebuildFromRaw=function(e){try{e=e.replace(/\\/g,"\\\\");let t={SubGroups:JSON.parse(e).FormFields};console.log("FC",t),n(t,document.getElementById("sub-create"))}catch(e){console.error(e),alert("Issue with rebuilding")}},t.setFieldsAsDisabled=a,t.createNewSubgroup=l,t.createNewResponseElement=r,t.deleteContainer=function(e,t){document.getElementById(e).removeChild(document.getElementById(t))},t.createTextAreaInputs=i,t.createFileInputs=o,t.createInputInputs=d,t.createSelectGroup=s,t.addListField=c,t.removeListItem=function(e,t){let n=e.getAttribute("data-link-id"),a=document.getElementById(n+"-"+t);a.childNodes.length<=1||a.removeChild(a.lastChild)},t.createOptionsGroup=m,t.responseTypeSelected=function(e,t){let n=t.getAttribute("data-link-id"),a=document.getElementById(n+"-type"),l=document.getElementById(n+"-fields");switch(console.log(n,a,l),a.value){case"textarea":i(n,e,l);break;case"input":d(n,e,l);break;case"file":o(n,e,l);break;case"select":s(0,e,l);break;case"option":m(0,e,l)}},t.submitForm=u,t.sendCreateRequest=p,t.handleCreateComplete=b,t.postDeleteForm=function(e,t){if(1==confirm("This will remove the form from the display and database.\n    Information files will retained on the server as a record until a duplicate named form is created")){let n=new XMLHttpRequest;n.open("POST",`/mod/form/delete/${e}/${t}`),n.onload=n=>{let a={};try{a=JSON.parse(n.target.responseText)}catch(e){return void alert("Error: Hard server crash")}if(a.error)alert("Error: "+a.error);else{alert("Success: "+a.message);let n=document.getElementById(`row-${e}-${t}`);n.parentNode.removeChild(n)}},n.send()}return!1},t.postDeleteResponse=function(e,t){if(1==confirm("This will remove the response and all information associated with it")){let n=new XMLHttpRequest;n.open("POST",`/mod/response/delete/${e}/${t}`),n.onload=n=>{let a={};try{a=JSON.parse(n.target.responseText)}catch(e){return void alert("Error: Hard server crash")}if(a.error)alert("Error: "+a.error);else{alert("Success: "+a.message);let n=document.getElementById(`row-${e}-${t}`);n.parentNode.removeChild(n)}},n.send()}return!1}})(),e})()));